<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Générateur de Fiche de Paie</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.25/jspdf.plugin.autotable.min.js"></script>
    <style>
        body { font-family: Arial; margin: 20px; }
        button { 
            padding: 10px 15px; 
            background: #0066cc; 
            color: white; 
            border: none; 
            cursor: pointer;
            font-size: 16px;
            margin-top: 20px;
        }
    </style>
</head>
<body>
    <button onclick="genererPDF()">Générer la fiche de paie</button>

    <script>
        const { jsPDF } = window.jspdf;
        
        function genererPDF() {
            const doc = new jsPDF();
            const periode = "du 01/01/2025 au 31/01/2025";
            
            // Configuration
            doc.setProperties({
                title: 'Bulletin de paie ' + periode,
                subject: 'Bulletin de salaire',
                author: 'Entreprise',
                keywords: 'paie, salaire, bulletin'
            });
            
            // Titre principal avec période
            doc.setFontSize(14);
            doc.text("BULLETIN DE SALAIRE - " + periode.toUpperCase(), 105, 15, { align: 'center' });
            
            // Informations entreprise/salarié sur 2 colonnes
            doc.setFontSize(9);
            
            // Colonne Entreprise
            doc.text("SIRET : 1234567890002", 20, 25);
            doc.text("ENTREPRISE : SOCIETE RUE ANONYME", 20, 30);
            doc.text("ADRESSE : 4 RUE DE LA PAIX", 20, 35);
            doc.text("70015 PARIS", 20, 40);
            doc.text("TÉL : 01 23 45 67 89", 20, 45);
            doc.text("EMAIL : contact@entreprise.com", 20, 50);
            
            // Colonne Salarié
            doc.text("NOM : DUBOIS Jérôme", 120, 25);
            doc.text("ADRESSE : 4 rue de la paix", 120, 30);
            doc.text("70015 PARIS", 120, 35);
            doc.text("N° SÉCURITÉ SOCIALE : 1 23 45 67 891 234", 120, 40);
            doc.text("TÉL : 06 12 34 56 78", 120, 45);
            doc.text("EMAIL : j.dubois@email.com", 120, 50);
            
            // Ligne de séparation
            doc.line(20, 55, 190, 55);
            
            // Tableau unique optimisé
            doc.autoTable({
                startY: 60,
                head: [['', 'Base', 'Taux', 'Montant', 'Charges Pat.']],
                body: [
                    // Salaire
                    ['Salaire de base', '151.67h', '17.3939€', '2 638.13€', ''],
                    ['Prime ancienneté', '', '', '140.85€', ''],
                    ['Total brut', '', '', '4 778.98€', ''],
                    
                    // Cotisations
                    ['Cot. sociales', '2 778.98€', '13%', '-361.27€', '1 143.39€'],
                    ['CSG/CRDS', '2 852.01€', '9.7%', '-276.65€', ''],
                    
                    // Avantages
                    ['Titres restaurant', '22.00€', '3.6%', '-79.20€', '118.80€'],
                    ['NAVIGO', '65.20€', '50%', '32.60€', ''],
                    
                    // Total
                    ['Net à payer', '', '', '2 028.77€', ''],
                    ['Taux personnalisé', '', '', '', '2 028.77€']
                ],
                margin: { left: 15, right: 15 },
                styles: { 
                    fontSize: 8,
                    cellPadding: 3,
                    overflow: 'linebreak'
                },
                headStyles: { 
                    fillColor: [220, 220, 220],
                    textColor: [0, 0, 0],
                    fontStyle: 'bold'
                },
                columnStyles: {
                    0: { cellWidth: 60, fontStyle: 'bold' },
                    1: { cellWidth: 25 },
                    2: { cellWidth: 20 },
                    3: { cellWidth: 30, halign: 'right' },
                    4: { cellWidth: 30, halign: 'right' }
                },
                didParseCell: function(data) {
                    // Mise en forme des lignes importantes
                    if (data.row.index === 2 || data.row.index === 7) {
                        data.cell.styles.fontStyle = 'bold';
                        data.cell.styles.fillColor = [240, 240, 240];
                    }
                }
            });
            
            // Mentions légales compactes
            doc.setFontSize(7);
            doc.text("Date d'édition : " + new Date().toLocaleDateString() + " - Convention collective : Métiers du tertiaire", 
                   105, 285, { align: 'center' });
            
            // Sauvegarde
            doc.save('bulletin_paie_janvier_2025.pdf');
        }
    </script>
</body>
</html>
