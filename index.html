<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Formulaire Bulletin de Paie</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js" defer></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.25/jspdf.plugin.autotable.min.js" defer></script>
    <style>
        body { font-family: Arial; margin: 20px; }
        label { display: block; margin: 10px 0 5px; }
        input { width: 100%; padding: 8px; margin-bottom: 10px; }
        .form-section { max-width: 600px; margin: 0 auto; }
        button { padding: 10px 15px; background: #0066cc; color: white; border: none; cursor: pointer; font-size: 16px; margin-top: 20px; display: block; width: 100%; }
    </style>
</head>
<body>
    <div class="form-section">
        <h2>Informations Entreprise</h2>
        <label for="nomEntreprise">Nom de l'entreprise</label>
        <input type="text" id="nomEntreprise" value="SOCIETE RUE ANONYME">
        <label for="adresseEntreprise">Adresse</label>
        <input type="text" id="adresseEntreprise" value="4 RUE DE LA PAIX">
        <label for="villeEntreprise">Ville</label>
        <input type="text" id="villeEntreprise" value="70015 PARIS">
        <label for="siret">SIRET</label>
        <input type="text" id="siret" value="1234567890002">
        <label for="telEntreprise">Téléphone</label>
        <input type="text" id="telEntreprise" value="01 23 45 67 89">

        <h2>Informations Salarié</h2>
        <label for="nomSalarie">Nom du salarié</label>
        <input type="text" id="nomSalarie" value="JEROME DUBOIS">
        <label for="adresseSalarie">Adresse</label>
        <input type="text" id="adresseSalarie" value="4 rue de la paix">
        <label for="villeSalarie">Ville</label>
        <input type="text" id="villeSalarie" value="70015 Paris">
        <label for="emailSalarie">Email</label>
        <input type="text" id="emailSalarie" value="jerome.dubois@email.com">
        <label for="telSalarie">Téléphone</label>
        <input type="text" id="telSalarie" value="06 12 34 56 78">
        <label for="secuSalarie">N° Sécurité Sociale</label>
        <input type="text" id="secuSalarie" value="2 2800000000000">

        <h2>Période et Salaire</h2>
        <label for="mois">Mois</label>
        <input type="text" id="mois" value="04">
        <label for="annee">Année</label>
        <input type="text" id="annee" value="2025">
        <label for="salaireBrut">Salaire Brut</label>
        <input type="text" id="salaireBrut" value="2778.98">

        <button onclick="genererPDF()">Générer la fiche de paie</button>
    </div>

    <script>
        window.onload = function () {
            const { jsPDF } = window.jspdf;

            window.genererPDF = function () {
                const doc = new jsPDF();
                const salaireBrut = parseFloat(document.getElementById("salaireBrut").value);
                const periode = `Période : ${document.getElementById("mois").value}/${document.getElementById("annee").value}`;

                const lignesPaie = [
                    ["Salaire de base", "151.67h", "17.3939", "", salaireBrut.toFixed(2), ""],
                    ["Maladie - maternité - invalidité - décès", salaireBrut, "0.75%", (salaireBrut * 0.0075).toFixed(2), "", (salaireBrut * 0.013).toFixed(2)],
                    ["Assurance vieillesse déplafonnée", salaireBrut, "0.40%", (salaireBrut * 0.004).toFixed(2), "", (salaireBrut * 0.018).toFixed(2)],
                    ["Assurance chômage", salaireBrut, "2.4%", (salaireBrut * 0.024).toFixed(2), "", (salaireBrut * 0.04).toFixed(2)],
                    ["Retraite complémentaire", salaireBrut, "3.15%", (salaireBrut * 0.0315).toFixed(2), "", (salaireBrut * 0.08).toFixed(2)],
                    ["CSG déductible", salaireBrut, "6.8%", (salaireBrut * 0.068).toFixed(2), "", ""],
                    ["CSG/CRDS non déductible", salaireBrut, "2.9%", (salaireBrut * 0.029).toFixed(2), "", ""],
                    ["Impôt sur le revenu prélevé à la source", salaireBrut, "5%", (salaireBrut * 0.05).toFixed(2), "", ""]
                ];

                const totalSalarial = lignesPaie.reduce((acc, l) => acc + parseFloat(l[3] || 0), 0);
                const totalPatronal = lignesPaie.reduce((acc, l) => acc + parseFloat(l[5] || 0), 0);
                const netAPayer = +(salaireBrut - totalSalarial).toFixed(2);

                lignesPaie.push(["", "", "TOTAL", totalSalarial.toFixed(2), netAPayer.toFixed(2), totalPatronal.toFixed(2)]);
                lignesPaie.push(["NET À PAYER EN EUROS", "", "", "", netAPayer.toFixed(2), ""]);

                doc.setFontSize(14);
                doc.text("BULLETIN DE SALAIRE", 105, 10, { align: 'center' });
                doc.setFontSize(10);
                doc.text(periode, 105, 16, { align: 'center' });

                doc.setFont(undefined, 'bold');
                doc.text("Entreprise :", 15, 25);
                doc.text("Salarié :", 115, 25);
                doc.setFont(undefined, 'normal');

                const infosEntreprise = [
                    document.getElementById("nomEntreprise").value,
                    document.getElementById("adresseEntreprise").value,
                    document.getElementById("villeEntreprise").value,
                    "SIRET : " + document.getElementById("siret").value,
                    "Téléphone : " + document.getElementById("telEntreprise").value
                ];

                const infosSalarie = [
                    document.getElementById("nomSalarie").value,
                    document.getElementById("adresseSalarie").value,
                    document.getElementById("villeSalarie").value,
                    "Email : " + document.getElementById("emailSalarie").value,
                    "Téléphone : " + document.getElementById("telSalarie").value,
                    "N° SS : " + document.getElementById("secuSalarie").value
                ];

                infosEntreprise.forEach((line, index) => {
                    doc.text(line, 15, 30 + index * 5);
                });

                infosSalarie.forEach((line, index) => {
                    doc.text(line, 115, 30 + index * 5);
                });

                doc.autoTable({
                    startY: 65,
                    head: [["Éléments de paie", "Base", "Taux", "À déduire", "À payer", "Charges patronales"]],
                    body: lignesPaie,
                    margin: { left: 15 },
                    styles: { fontSize: 8, cellPadding: 2 },
                    headStyles: { fillColor: [33, 64, 154], textColor: [255, 255, 255] }
                });

                doc.save("bulletin_paie.pdf");
            }
        };
    </script>
</body>
</html>
