<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Générateur de Fiche de Paie</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.25/jspdf.plugin.autotable.min.js"></script>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .input-group { margin-bottom: 15px; }
        label { display: inline-block; width: 200px; }
        input { padding: 5px; width: 200px; }
        button { 
            padding: 10px 20px; 
            background: #0066cc; 
            color: white; 
            border: none; 
            cursor: pointer; 
            margin-top: 20px;
            font-size: 16px;
        }
    </style>
</head>
<body>
    <h1>Générateur de Fiche de Paie</h1>
    
    <div class="input-group">
        <label for="entreprise">Nom de l'entreprise :</label>
        <input type="text" id="entreprise" value="SOCIETE RUE ANONYME">
    </div>
    
    <div class="input-group">
        <label for="adresse">Adresse :</label>
        <input type="text" id="adresse" value="4 RUE DE LA PAIX 70015 PARIS">
    </div>
    
    <div class="input-group">
        <label for="siret">SIRET :</label>
        <input type="text" id="siret" value="1234567890002">
    </div>
    
    <div class="input-group">
        <label for="salarie">Nom du salarié :</label>
        <input type="text" id="salarie" value="Monsieur JEROME DUBOIS">
    </div>
    
    <div class="input-group">
        <label for="salaire-brut">Salaire brut :</label>
        <input type="number" id="salaire-brut" value="2778.98">
    </div>
    
    <div class="input-group">
        <label for="heures">Heures travaillées :</label>
        <input type="number" id="heures" value="151.67">
    </div>
    
    <button onclick="genererPDF()">Générer la fiche de paie</button>

    <script>
        const { jsPDF } = window.jspdf;
        
        function genererPDF() {
            const doc = new jsPDF();
            
            // Récupération des valeurs
            const entreprise = document.getElementById('entreprise').value;
            const adresse = document.getElementById('adresse').value;
            const siret = document.getElementById('siret').value;
            const salarie = document.getElementById('salarie').value;
            const salaireBrut = parseFloat(document.getElementById('salaire-brut').value);
            const heures = document.getElementById('heures').value;
            
            // Calculs automatiques (simplifiés)
            const primeAnciennete = 140.85;
            const totalBrut = salaireBrut + primeAnciennete;
            
            // Cotisations salariales (taux 2023)
            const cotisations = {
                secuMaladie: Math.min(salaireBrut, 3428) * 0.13,
                retraitePlafonnee: Math.min(salaireBrut, 3428) * 0.069,
                retraiteDeplafonnee: salaireBrut * 0.004,
                famille: salaireBrut * 0.0345,
                csgCrds: salaireBrut * 0.097,
                chomage: Math.min(salaireBrut, 3428) * 0.042
            };
            
            const totalCotisations = Object.values(cotisations).reduce((a, b) => a + b, 0);
            const netAPayer = totalBrut - totalCotisations;
            
            // En-tête
            doc.setFontSize(16);
            doc.text(entreprise, 105, 15, { align: 'center' });
            
            doc.setFontSize(10);
            const adresseLines = adresse.split('\n');
            adresseLines.forEach((line, i) => {
                doc.text(line, 105, 20 + (i * 5), { align: 'center' });
            });
            
            // Informations entreprise
            doc.text(`Siret : ${siret}`, 20, 35);
            doc.text("Code Naf : 00002", 20, 40);
            doc.text("Ursa/MSa : 12700000124563979", 20, 45);
            doc.text("Matricule : 00001", 20, 50);
            doc.text("N° S5 : 289000000000", 20, 55);
            doc.text("Iban / Rib : FR76 XXXX XXXX XXX", 20, 60);
            
            doc.text("Emploi : non cadre", 120, 35);
            doc.text("Statut professionnel : Employé", 120, 40);
            doc.text("Niveau : XX", 120, 45);
            doc.text("Coefficient : xxx", 120, 50);
            doc.text("Entrée : 01/01/2018", 120, 55);
            doc.text("Ancienneté : ", 120, 60);
            doc.text("Convention collective : xxxxxxxxxxxxx", 120, 65);
            
            // Ligne de séparation
            doc.line(20, 70, 190, 70);
            
            // Informations salarié
            doc.setFontSize(12);
            doc.text(salarie, 20, 80);
            doc.setFontSize(10);
            doc.text("4 rue de la paix", 20, 85);
            doc.text("70015 Paris", 20, 90);
            
            // Tableau éléments de paie
            doc.setFontSize(12);
            doc.text("ÉLÉMENTS DE PAIE", 20, 100);
            
            doc.autoTable({
                startY: 105,
                head: [['Éléments de paie', 'Base', 'Taux', 'A déduire', 'A payer', 'Charges patronales']],
                body: [
                    ['Salaire de base', heures, '17.3939', '', salaireBrut.toFixed(2), ''],
                    ['Prime d\'ancienneté', '', '', '', primeAnciennete.toFixed(2), ''],
                    ['Salaire brut', '', '', '', totalBrut.toFixed(2), ''],
                    ['Santé', '', '', '', '', ''],
                    ['Sécurité Sociale - Mal. Mat. Inval. Déclés', Math.min(salaireBrut, 3428).toFixed(2), '13%', cotisations.secuMaladie.toFixed(2), '', '7% | ' + (Math.min(salaireBrut, 3428) * 0.07).toFixed(2)],
                    ['Retraite plafonnée', Math.min(salaireBrut, 3428).toFixed(2), '6.9%', cotisations.retraitePlafonnee.toFixed(2), '', '8.55% | ' + (Math.min(salaireBrut, 3428) * 0.0855).toFixed(2)],
                    ['Retraite déplafonnée', salaireBrut.toFixed(2), '0.4%', cotisations.retraiteDeplafonnee.toFixed(2), '', '1.9% | ' + (salaireBrut * 0.019).toFixed(2)],
                    ['Famille', salaireBrut.toFixed(2), '3.45%', cotisations.famille.toFixed(2), '', '3.45% | ' + (salaireBrut * 0.0345).toFixed(2)],
                    ['CSG/CRDS', salaireBrut.toFixed(2), '9.7%', cotisations.csgCrds.toFixed(2), '', ''],
                    ['Assurance chômage', Math.min(salaireBrut, 3428).toFixed(2), '4.2%', cotisations.chomage.toFixed(2), '', '4.2% | ' + (Math.min(salaireBrut, 3428) * 0.042).toFixed(2)],
                    ['Total des cotisations', '', '', totalCotisations.toFixed(2), '', ''],
                    ['Net à payer avant impôt', '', '', '', netAPayer.toFixed(2), '']
                ],
                margin: { left: 20 },
                styles: { fontSize: 7, cellPadding: 2 },
                headStyles: { fillColor: [220, 220, 220] },
                columnStyles: {
                    0: { cellWidth: 60 },
                    1: { cellWidth: 20 },
                    2: { cellWidth: 20 },
                    3: { cellWidth: 20 },
                    4: { cellWidth: 20 },
                    5: { cellWidth: 30 }
                }
            });
            
            // Récapitulatif
            doc.setFontSize(12);
            doc.text("RÉCAPITULATIF", 20, doc.lastAutoTable.finalY + 10);
            
            doc.autoTable({
                startY: doc.lastAutoTable.finalY + 15,
                head: [['', 'Heures', 'Heures suppl.', 'Brut', 'Plafond S.S.', 'Net imposable', 'Ch. nationales', 'Coût Global', 'Total versé', 'Allègements']],
                body: [
                    ['Mensuel', heures, '', salaireBrut.toFixed(2), '3 428.00', (salaireBrut * 0.8).toFixed(2), (salaireBrut * 0.45).toFixed(2), (salaireBrut * 1.45).toFixed(2), (salaireBrut * 1.4).toFixed(2), '216.76'],
                    ['Annuel', (heures * 12).toFixed(2), '', (salaireBrut * 12).toFixed(2), '27 424.00', (salaireBrut * 12 * 0.8).toFixed(2), (salaireBrut * 12 * 0.45).toFixed(2), (salaireBrut * 12 * 1.45).toFixed(2), (salaireBrut * 12 * 1.4).toFixed(2), '1 863.77']
                ],
                margin: { left: 20 },
                styles: { fontSize: 7, cellPadding: 2 },
                headStyles: { fillColor: [220, 220, 220] }
            });
            
            // Pied de page
            doc.setFontSize(8);
            doc.text("Modèle réalisé avec FichePay Generator", 105, 285, { align: 'center' });
            
            // Signature
            doc.text("Le salarié", 40, 270);
            doc.text("_________________________", 40, 275);
            
            doc.text("L'employeur", 140, 270);
            doc.text("_________________________", 140, 275);
            
            // Sauvegarde
            doc.save(`fiche_paie_${salarie.replace(' ', '_')}.pdf`);
        }
    </script>
</body>
</html>
