<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Générateur de Fiche de Paie</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.25/jspdf.plugin.autotable.min.js"></script>
    <style>
        body { font-family: Arial; margin: 20px; }
        button { 
            padding: 10px 15px; 
            background: #0066cc; 
            color: white; 
            border: none; 
            cursor: pointer;
            font-size: 16px;
            margin-top: 20px;
        }
    </style>
</head>
<body>
    <button onclick="genererPDF()">Générer la fiche de paie</button>

    <script>
        const { jsPDF } = window.jspdf;
        
        function genererPDF() {
            const doc = new jsPDF();
            const moisAnnee = "Mai 2023"; // À adapter selon besoin
            
            // Configuration
            doc.setProperties({
                title: 'Bulletin de paie ' + moisAnnee,
                subject: 'Bulletin de salaire',
                author: 'Entreprise',
                keywords: 'paie, salaire, bulletin',
                creator: 'Générateur de fiches de paie'
            });
            
            // Titre principal avec période
            doc.setFontSize(16);
            doc.setTextColor(0, 0, 0);
            doc.text("BULLETIN DE PAIE - " + moisAnnee, 105, 15, { align: 'center' });
            
            // Informations entreprise et salarié côte à côte
            doc.setFontSize(10);
            
            // Colonne Entreprise (gauche)
            doc.text("Siret : 1234567890002", 20, 25);
            doc.text("Code Naf : 00002", 20, 30);
            doc.text("Adresse : 4 RUE DE LA PAIX", 20, 35);
            doc.text("70015 PARIS", 20, 40);
            doc.text("Tél : 01 23 45 67 89", 20, 45);
            doc.text("Email : contact@entreprise.com", 20, 50);
            
            // Colonne Salarié (droite)
            doc.text("Nom : DUBOIS Jérôme", 120, 25);
            doc.text("Adresse : 4 rue de la paix", 120, 30);
            doc.text("70015 PARIS", 120, 35);
            doc.text("N° Sécurité sociale : 1 23 45 67 891 234", 120, 40);
            doc.text("Tél : 06 12 34 56 78", 120, 45);
            doc.text("Email : j.dubois@email.com", 120, 50);
            doc.text("Emploi : non cadre - Statut : Employé", 120, 55);
            
            // Ligne de séparation
            doc.line(20, 60, 190, 60);
            
            // Tableau éléments de paie (version compacte)
            doc.setFontSize(12);
            doc.text("ÉLÉMENTS DE PAIE", 20, 70);
            
            // Version optimisée pour A4
            doc.autoTable({
                startY: 75,
                head: [['Éléments', 'Base', 'Taux', 'Montant', 'Patronal']],
                body: [
                    ['Salaire de base', '151.67h', '17.3939€', '2 638.13€', ''],
                    ['Prime ancienneté', '', '', '140.85€', ''],
                    ['Total brut', '', '', '4 778.98€', ''],
                    ['Cot. sociales', '2 778.98€', '13%', '-361.27€', '1 143.39€'],
                    ['CSG/CRDS', '2 852.01€', '9.7%', '-276.65€', ''],
                    ['Net avant impôt', '', '', '2 028.77€', ''],
                    ['Titres restaurant', '22.00€', '3.6%', '-79.20€', '118.80€'],
                    ['NAVIGO', '65.20€', '50%', '32.60€', ''],
                    ['Total à payer', '', '', '2 028.77€', '']
                ],
                margin: { left: 15 },
                styles: { 
                    fontSize: 8,
                    cellPadding: 3,
                    overflow: 'linebreak'
                },
                headStyles: { 
                    fillColor: [220, 220, 220],
                    textColor: [0, 0, 0],
                    fontStyle: 'bold'
                },
                columnStyles: {
                    0: { cellWidth: 50 },
                    1: { cellWidth: 25 },
                    2: { cellWidth: 20 },
                    3: { cellWidth: 30 },
                    4: { cellWidth: 30 }
                }
            });
            
            // Récapitulatif compact
            doc.setFontSize(12);
            doc.text("RÉCAPITULATIF", 20, doc.lastAutoTable.finalY + 10);
            
            doc.autoTable({
                startY: doc.lastAutoTable.finalY + 15,
                head: [['Période', 'Heures', 'Brut', 'Net', 'Coût']],
                body: [
                    ['Mensuel', '151.67', '2 778.98€', '2 028.77€', '4 080.77€'],
                    ['Annuel', '1 213.36', '23 894.56€', '19 430.05€', '34 827.05€']
                ],
                margin: { left: 15 },
                styles: { 
                    fontSize: 8,
                    cellPadding: 3
                },
                headStyles: { 
                    fillColor: [220, 220, 220],
                    textColor: [0, 0, 0],
                    fontStyle: 'bold'
                }
            });
            
            // Mentions légales compactes
            doc.setFontSize(8);
            doc.text("Convention collective : Métiers du tertiaire", 20, doc.lastAutoTable.finalY + 15);
            doc.text("Date d'émission : " + new Date().toLocaleDateString(), 20, doc.lastAutoTable.finalY + 20);
            
            // Signature
            doc.text("Le salarié", 40, 270);
            doc.text("_________________________", 40, 275);
            
            doc.text("L'employeur", 140, 270);
            doc.text("_________________________", 140, 275);
            
            // Sauvegarde
            doc.save('bulletin_paie_' + moisAnnee.replace(' ', '_') + '.pdf');
        }
    </script>
</body>
</html>
